<Project>

	<Choose>
		<When Condition="'$(SolutionDir)' == ''">
			<PropertyGroup>
				<SolutionDir>$(ProjectDir)..\</SolutionDir>
			</PropertyGroup>
		</When>
	</Choose>

	<Choose>
		<When Condition="'$(Configurations)' == ''">
			<PropertyGroup>
				<Configurations>1.3;1.4;1.3_DEBUG;1.4_DEBUG</Configurations>
			</PropertyGroup>
		</When>
	</Choose>

	<Choose>

		<When Condition="$(Configuration.StartsWith('1.3'))">

			<PropertyGroup>
				<GameDir>D:\Steam\steamapps\common\RimWorld\</GameDir>
				<DefineConstants>$(DefineConstants);v1_3</DefineConstants>
			</PropertyGroup>
			<ItemGroup>
				<PackageReference Include="Krafs.Rimworld.Ref" Version="1.3.*" ExcludeAssets="runtime" />
			</ItemGroup>

		</When>
		<When Condition="$(Configuration.StartsWith('1.4'))">

			<PropertyGroup>
				<GameDir>D:\Steam\steamapps\common\RimWorld\</GameDir>
				<DefineConstants>$(DefineConstants);v1_4</DefineConstants>
			</PropertyGroup>
			<ItemGroup>
				<PackageReference Include="Krafs.Rimworld.Ref" Version="1.4.*-*" ExcludeAssets="runtime" />
			</ItemGroup>

		</When>

	</Choose>

	<Choose>
		<When Condition="$(Configuration.EndsWith('DEBUG'))">
			<PropertyGroup>
				<DebugType>full</DebugType>
				<DefineConstants>$(DefineConstants);DEBUG</DefineConstants>
			</PropertyGroup>
		</When>
		<Otherwise>
			<PropertyGroup>
				<DebugType>none</DebugType>
			</PropertyGroup>
		</Otherwise>
	</Choose>

	<PropertyGroup>
		<TargetFramework>net48</TargetFramework>
		<OutputType>Library</OutputType>
		<LangVersion>preview</LangVersion>
		<Nullable>annotations</Nullable>
		<EnablePreviewFeatures>true</EnablePreviewFeatures>
		<AllowUnsafeBlocks>true</AllowUnsafeBlocks>
		<AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
		<RootNamespace>$(MSBuildProjectName.Replace(" ", "."))</RootNamespace>
		<NoWarn>MSB3052;CS8618;CS8603</NoWarn>

		<ModName>$(AssemblyName)</ModName>

		<ModBaseOutputPath>$(ProjectDir)build\</ModBaseOutputPath>
		<ModOutputPath>$(ModBaseOutputPath)$(ModName)\</ModOutputPath>
		<ModOutputVersion>$(ModOutputPath)$(Configuration.Replace('_DEBUG', ''))\</ModOutputVersion>
		<ModOutputAssemblies>$(ModOutputVersion)Assemblies\</ModOutputAssemblies>
		<PackageOutputPath>$(ProjectDir)</PackageOutputPath>

		<AssetsDir>$(ProjectDir)Assets\</AssetsDir>
		
		<GameModsDir>$(GameDir)Mods\</GameModsDir>

		<RunPostBuildEvent>Always</RunPostBuildEvent>
		<RunPreBuildEvent>Always</RunPreBuildEvent>

	</PropertyGroup>

	<ItemGroup>
		<Compile Remove="$(ModBaseOutputPath)**" />
		<EmbeddedResource Remove="$(ModBaseOutputPath)**" />
		<None Remove="$(ModBaseOutputPath)**" />
	</ItemGroup>
	
	<Target Name="cleanup" AfterTargets="BeforeClean">
		<Exec Command="rmdir /S /Q &quot;$(ModBaseOutputPath)&quot;" />
		<Exec Command="rmdir /S /Q &quot;$(BaseOutputPath)&quot;" />
		<Exec Command="rmdir /S /Q &quot;$(BaseIntermediateOutputPath)&quot;" />
	</Target>
	
	<Target Name="prebuild" AfterTargets="PreBuildEvent">
		<Exec Command="rmdir /S /Q &quot;$(ModOutputAssemblies)&quot;" />
		<Exec Command="rmdir /S /Q &quot;$(GameModsDir)$(ModName)&quot;" />
	</Target>
	
	<Target Name="postbuild" AfterTargets="PostBuildEvent">
		<MakeDir Directories="$(ModOutputPath)" />
		<Exec Command="xcopy /Y /R /S /I &quot;$(AssetsDir)&quot; &quot;$(ModOutputPath)&quot;" />
		<Exec Command="xcopy /Y /R /S /I &quot;$(OutputPath)&quot; &quot;$(ModOutputAssemblies)&quot;" />
		<Exec Command="xcopy /Y /R /S /I &quot;$(ModOutputPath)&quot; &quot;$(GameModsDir)$(ModName)&quot;" />
	</Target>

	<ItemGroup>
		<Using Include="System" />
		<Using Include="System.Reflection" />
		<Using Include="System.Collections" />
		<Using Include="System.Collections.Generic" />
		<Using Include="System.Linq" />
		<Using Include="UnityEngine" />
		<Using Include="RimWorld" />
		<Using Include="Verse" />
		<Using Include="Verse.AI" />
		<Using Static="true"
			   Include="Verse.TranslatorFormattedStringExtensions"/>
	</ItemGroup>

</Project>